<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>榔头男的传说Ending</title>
<style>
:root {
  --bg: #0b0f14;
  --panel: rgba(20, 24, 30, 0.7);
  --panel-solid: #151922;
  --text: #e7ebf3;
  --muted: #9aa7b3;
  --accent: #8ab4ff;
}
html, body {
  margin:0; padding:0; height:100%; background: var(--bg); color: var(--text);
  font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
}
.stage { position: relative; width:100%; height:100vh; overflow:hidden; background: none; }
.bg { position:absolute; inset:0; background-size:cover; background-position:center center;
  filter: brightness(1.2) contrast(1.05) saturate(1.1); transition: opacity 0.6s ease-in-out; opacity:1; }
.film-grain::after { content: ""; position:absolute; inset:-10%; pointer-events:none;
  mix-blend-mode: soft-light; opacity: .35;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
  background-size: 350px 350px; animation: grain 7s steps(10) infinite; }
@keyframes grain { 0% { transform: translate(0,0) } 100% { transform: translate(-10px,-10px) } }
.vignette { position:absolute; inset:0; pointer-events:none; box-shadow: inset 0 0 160px 40px rgba(0,0,0,.85); }

.subtitle { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
  background: rgba(0,0,0,0); color: var(--text);
  padding: 1.2rem 2.5rem; border-radius:16px;
  max-width:90%; text-align:center; line-height:1.6;
  font-size: clamp(28px,5vw,48px); font-weight:800; font-family:"方正大黑体_GBK", "Arial", sans-serif;
  letter-spacing:1px; opacity:0; transition: opacity 1s ease-in-out; z-index:10; }
.subtitle.show { opacity:1; }

.dialogue { position:absolute; left:50%; bottom:3.5%; transform:translateX(-50%);
  width:min(1100px,92%); background: var(--panel); backdrop-filter: blur(8px) saturate(110%);
  border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.35);
  padding:1.1rem 1.2rem 1rem; cursor:pointer; user-select:none;
  display:none; transition: opacity 0.5s; }
.name { display:inline-flex; gap:.5rem; align-items:center; font-weight:700; letter-spacing:.03em; color: var(--accent); margin-bottom:.25rem; font-size: clamp(14px,2.3vw,16px);}
.text { font-size: clamp(15px,2.6vw,19px); line-height:1.8; min-height:3lh; white-space: pre-wrap;font-family: "Source Han Sans", "PingFang SC", "Microsoft YaHei", sans-serif; }
.hint { color: var(--muted); font-size:12px; margin-top:.45rem; }

.choices { display:grid; gap:.6rem; margin-top:.8rem; }
.choice { background: var(--panel-solid); border:1px solid rgba(255,255,255,.07); border-radius:12px; padding:.7rem .9rem; cursor:pointer; transition:160ms ease; }
.choice:hover { transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.25); }

.flash { position:absolute; inset:0; background-size:cover; background-position:center; opacity:0; pointer-events:none; transition: opacity 80ms linear; }

.topbar { position:absolute; inset-inline:2%; top:2%; display:flex; gap:.5rem; align-items:center; z-index:20; }
.btn { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.09); color: var(--text); padding:.45rem .7rem; border-radius:10px; font-size:12px; cursor:pointer; transition:160ms ease; backdrop-filter: blur(6px); }
.btn:hover { transform: translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.25); }

.muted { color: var(--muted); position: absolute; bottom: 1%; left:50%; transform: translateX(-50%);
  font-size: 14px; opacity:0; transition: opacity 0.5s; z-index:10; }
.muted.show { opacity:1; }

.credits { position:relative; text-align:center; font-size:20px; line-height:1.8; color:#fff; white-space:pre-wrap;
  max-width:900px; padding:0 1rem;font-family: "Noto Serif SC", "Merriweather", "Times New Roman", serif; }
</style>
</head>
<body>
<div class="stage film-grain" id="stage">
  <div class="bg" id="bg" aria-hidden="true"></div>
  <div class="vignette" id="vignette"></div>

  

  <div class="subtitle" id="subtitle"></div>

  <div class="dialogue" id="dialogue" role="button" aria-label="下一句">
    <div class="name" id="name">&nbsp;</div>
    <div class="text" id="text"></div>
    <div class="choices" id="choices" hidden></div>
    <div class="hint">点击继续 ▸</div>
  </div>

  <div class="flash" id="flash"></div>
  <div class="muted" id="muted">（点击任意位置或空格键以继续）</div>
</div>

<script>
const el=id=>document.getElementById(id);
const nameEl=el('name'), textEl=el('text'), choicesEl=el('choices'), subtitleEl=el('subtitle');
const dialogueEl=el('dialogue'), bgEl=el('bg'), mutedEl=el('muted');


let idx=0, skipType=false, autoPlay=false, typing=false, waitingChoice=false;
let currentBg='', inMontage=false;

let bgm=null;
let bgmMain=new Audio('main.mp3');
bgmMain.loop=true;
bgmMain.volume=0.6;
let mainStarted=false;
let bgmEnd = null; // 结尾 credits 音乐

function tryPlayMain(){
  if(!mainStarted){
    bgmMain.play().catch(()=>{});
    mainStarted=true;
  }
}

document.addEventListener('click', tryPlayMain);
document.addEventListener('keydown', e=>{ if(e.code==='Space') tryPlayMain(); });
dialogueEl.addEventListener('click', tryPlayMain);

async function typeText(str){
  typing=true; textEl.innerHTML='';
  const speed=60;
  for(let i=0;i<str.length;i++){
    if(skipType){ textEl.innerHTML=str.replace(/\n/g,'<br>'); break; }
    textEl.innerHTML += (str[i]==='\n'?'<br>':str[i]);
    await new Promise(r=>setTimeout(r,speed));
  }
  typing=false;
  if(autoPlay && !inMontage && !waitingChoice) setTimeout(next,1800);
}

const script=[
  {t:'music',url:'main.mp3'},
  {t:'bg',url:'images/1.png'},
  {t:'say',name:'',text:'我原本以为自己拥有稳定的幸福。'},
  {t:'say',name:'',text:'和他在一起的八年里，我把自己最好的时光都给了他。'},
  {t:'say',name:'',text:'那时的我，其实有一份令人骄傲的事业。我本可以继续向上攀登，站在更高的位置，赢得掌声与尊重。'},
  {t:'bg',url:'images/2.png'},
  {t:'say',name:'',text:'可为了爱，我选择了停下脚步，放弃了升职的机会，只为了留在他的身边。'},
  {t:'say',name:'',text:'八年间，我收起了骄傲，把所有精力都倾注在他身上。陪他度过困境，打点生活，在他最灰暗的时候也不离不弃。'},
  {t:'bg',url:'images/3.png'},
  {t:'say',name:'',text:'可她出现了。那个长发的女人，只是一个笑容，就轻而易举地夺走了他。'},
  {t:'say',name:'',text:'她凭什么？'},
  {t:'say',name:'',text:'我哪里不如她？长相？学历？还是那些浅薄的笑容？'},
  {t:'say',name:'',text:'我曾为他放弃事业，收起骄傲，把整个青春都交给了他。可到头来，却输给了一个后来者。'},
  {t:'say',name:'',text:'为什么我付出的八年，会被轻易抹杀？为什么要让我独自承担屈辱与痛苦？'},
  {t:'say',name:'',text:'但我瘦小、普通。我无法质问那个男人，更不敢去拉回他早已移开的目光。'},
  {t:'say',name:'',text:'我的愤怒找不到出口，就像一团燃烧的火，被压在胸口，几乎要把我焚毁。'},
  {t:'bg',url:'images/15.png'},
  {t:'say',name:'',text:'于是，我创造了一个虚幻的怪物——“榔头男”。高大、残忍，专门猎杀长发的女人。'},
  {t:'say',name:'',text:'她们该死，是她们这样的女人夺走了我的幸福！她们的笑容，是对我全部牺牲的嘲讽。'},
  {t:'say',name:'',text:'人们开始谈论他，害怕他……'},
  {t:'say',name:'',text:'而在阴影下笑的人，只有我。'},
  {t:'bg',url:'images/10.png'},
  {t:'say',name:'',text:'我盯上了第一个目标——一个长发的女人。我跟着她，听着她鞋跟敲击地面的声音。她突然回头，我毫不犹豫地抡下了榔头。'},
  {t:'bg',url:'images/18.png'},
  {t:'say',name:'',text:'她尖叫，她害怕。我看到她眼里的恐惧，心里涌起病态的满足。'},
  {t:'bg',url:'images/16.png'},
  {t:'say',name:'',text:'我一遍遍地重复。留下痕迹与道具，精心编织“榔头男”的假象。'},
  {t:'say',name:'',text:'看着警察和市民惊恐地议论，我心里竟感到一种快感。他们口中可怕的怪物，其实就是我——一个再普通不过的女人。'},
  {t:'bg',url:'images/12.png'},
  {t:'say',name:'',text:'上一次作案后，我回到家，却发现楼下有陌生的身影在徘徊，久久不肯离去。'},
  {t:'say',name:'',text:'我心里清楚：自己已经被盯上了。我不能坐以待毙。'},
  {t:'say',name:'',text:'既然“榔头男”只是我虚构的影子，他的生死，完全由我掌控。'},
  {t:'bg',url:'images/4.png'},
  {t:'say',name:'',text:'我需要一个替死鬼。为了保险，我一次性布下了三步棋。'},
  {t:'bg',url:'images/13.png'},
  {t:'say',name:'',text:'第一步，我让快递员送来一把沉重的扳手——那是我故意留下的关键道具。'},
  {t:'bg',url:'images/9.png'},
  {t:'say',name:'',text:'第二步，我约来了一名机车收货员。就在他踏入房间的瞬间，我用榔头击倒了他，'},
  {t:'bg',url:'images/14.png'},
  {t:'say',name:'',text:'我布置现场，伪装成一场自杀：安眠药散落在床边，扣着的帽子遮住了头上的伤口。'},
  {t:'bg',url:'images/5.png'},
  {t:'say',name:'',text:'而真正的细节，是我将房间里所有女士内衣裤一股脑打包进大包裹，烧毁两张送货单，清洗厕所，把长头发冲入下水道。'},
  {t:'bg',url:'images/6.png'},
  {t:'say',name:'',text:'再用新的剃须刀伪装自己是男性'},
  {t:'bg',url:'images/8.png'},
  {t:'say',name:'',text:'我还整理了鞋柜：原本平时伪装“榔头男”的男性鞋子，都放回原位，和机车收货员的鞋子一起布置，让整个房间看起来更自然，更像有人常住。'},
  {t:'say',name:'',text:'伪装成机车取货员的我，背着“装满内衣的包裹”，从楼道快步离开。在外人眼中，我只是个普通收货员。'},
  {t:'say',name:'',text:'但我很清楚，这种拙劣的自杀伪装，骗不了警察，它最多只能拖延几个小时。'},
  {t:'bg',url:'images/17.png'},
  {t:'say',name:'',text:'所以我布下了第三步。'},
  {t:'say',name:'',text:'我再次叫来一个人，让他误打误撞闯入现场。在警方眼里，他似乎才是真凶——杀了“榔头男”，再随手把凶器塞进第一个快递员的包裹。'},
  {t:'black',duration:5000},
  {t:'music',url:'policecar.mp3'},
  {t:'bg',url:'images/19.png',duration:4000},
  {t:'black',stopMusic:true},
  {t:'credits'}
];

const creditsText=[
  "在这个世界上，最深的黑暗，往往由最痛的伤口滋生。",
  "我们以为制造恐惧就能掩盖脆弱，编织谎言就能夺回尊严。",
  "但每一次挥向他人的榔头，都在将自己砸向更深的深渊。",
  "榔头女不是怪物，也不是英雄；",
  "只是一个被恨意吞噬的、曾经相信过爱的普通人。",
  "希望这场虚幻的追猎，让你看清：执念如何将人扭曲，痛苦如何令爱失声。",
  "而真正的解脱，从来不在伤害别人——",
  "在于敢于直面那个，破碎却真实的自己。"
];

function setBackground(url){
  if(url===currentBg) return;
  currentBg=url;
  bgEl.style.opacity=0;
  setTimeout(()=>{ 
    bgEl.style.backgroundImage=`linear-gradient(120deg, rgba(50,60,70,.35), rgba(10,12,16,.6)), url('${url}')`; 
    bgEl.style.opacity=1; 
  },600);
}

async function next(){
  if(waitingChoice) return;
  if(typing){ skipType=true; return; }
  skipType=false;
  const step=script[idx++];
  if(!step) return;

  subtitleEl.classList.remove('show');

  switch(step.t){
    case 'say':
      choicesEl.hidden=true; nameEl.textContent=step.name||''; dialogueEl.style.display='block';
      await typeText(step.text);
      updateMuted();
      break;

    case 'bg':
      setBackground(step.url);
      break;

    case 'black':
      bgEl.style.transition="opacity 1s ease";
      bgEl.style.opacity=0;
      if(step.stopMusic && bgm){ 
        bgm.pause(); 
        bgm=null; 
      } 
      setTimeout(next, step.duration || 1200);
      return;

    case 'music':
  if(step.url.toLowerCase()!=='main.mp3'){
    if(bgmMain){ bgmMain.pause(); }
    if(bgm){ bgm.pause(); bgm=null; }
    bgm = new Audio(step.url);
    bgm.loop=true;
    bgm.volume=0.6;
    bgm.play().catch(()=>{});
    
    // 如果是警笛声，就隐藏字幕框
    if(step.url.toLowerCase()==='policecar.mp3'){
      dialogueEl.style.display='none';
    }
  }
  break;


    case 'credits':
  dialogueEl.style.display='none';
  mutedEl.classList.remove('show');
  
  // 停掉前面的背景音乐
  if(bgm){ bgm.pause(); bgm = null; }
  if(bgmMain){ bgmMain.pause(); bgmMain = null; }

  // 播放结尾音乐
  bgmEnd = new Audio('endmusic.mp3');
  bgmEnd.volume = 0.6;
  bgmEnd.play().catch(()=>{}); // 避免浏览器阻止自动播放

  showCredits();
  break;


  }
}

function updateMuted(){ mutedEl.classList.add('show'); setTimeout(()=>mutedEl.classList.remove('show'),2000); }

function showCredits(){
  const overlay = document.createElement('div');
  overlay.id='__credits_overlay';
  overlay.style.position='fixed';
  overlay.style.inset='0';
  overlay.style.background='#000';
  overlay.style.zIndex='9999';
  overlay.style.display='flex';
  overlay.style.alignItems='center';
  overlay.style.justifyContent='center';
  overlay.style.padding='20px';
  document.body.appendChild(overlay);

  const container = document.createElement('div');
  container.className='credits';
  container.style.textAlign='center';
  container.style.maxWidth='800px';
  container.style.fontSize='20px';
  container.style.lineHeight='1.4';
  container.style.color='#fff';
  container.style.whiteSpace='pre-wrap';
  overlay.appendChild(container);

  creditsText.forEach((line, i)=>{
    const p = document.createElement('div');
    p.textContent = line;
    p.style.opacity = '0';
    p.style.transition = 'opacity 1.2s ease';
    p.style.marginBottom = '12px';
    container.appendChild(p);

    setTimeout(()=>{ p.style.opacity='1'; }, i*3000);
  });
  setTimeout(()=>{
    const hint = document.createElement('div');
    hint.style.marginTop = '18px';
    hint.style.fontSize = '14px';
    hint.style.color = '#888';
    container.appendChild(hint);
    document.addEventListener('keydown', restartFromCredits);
    document.addEventListener('click', restartFromCredits);
  }, creditsText.length * 2000 + 500);
}



document.addEventListener('keydown',e=>{ if(e.code==='Space') next(); });
dialogueEl.addEventListener('click',next);

document.addEventListener('click', ()=>{
  tryPlayMain();
  next();
});

next();
</script>
</body>
</html>
