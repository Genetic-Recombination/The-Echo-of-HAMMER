<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>再见 Second Sight</title>
    <link rel="stylesheet" href="./maze.css">
    <link href="../../favicon.ico" type="image/x-icon" rel="icon">
</head>
<body>
    <SCRIPT LANGUAGE="JavaScript">
        var maze = new Array()
        var sides = new Array("Border-Top", "Border-Right")
    
        for (var rows = 0; rows < 13; rows++){
            maze[rows] = new Array()
        }
    
        maze[0][0] = new Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
        maze[0][1] = new Array(0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1)
        maze[1][0] = new Array(1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1)
        maze[1][1] = new Array(0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1)
        maze[2][0] = new Array(1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1)
        maze[2][1] = new Array(0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1)
        maze[3][0] = new Array(0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1)
        maze[3][1] = new Array(1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1)
        maze[4][0] = new Array(0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1)
        maze[4][1] = new Array(1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1)
        maze[5][0] = new Array(0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0)
        maze[5][1] = new Array(1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1)
        maze[6][0] = new Array(0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1)
        maze[6][1] = new Array(1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1)
        maze[7][0] = new Array(1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1)
        maze[7][1] = new Array(1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1)
        maze[8][0] = new Array(0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0)
        maze[8][1] = new Array(0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1)
        maze[9][0] = new Array(0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1)
        maze[9][1] = new Array(1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1)
        maze[10][0] = new Array(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0)
        maze[10][1] = new Array(1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1)
        maze[11][0] = new Array(0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0)
        maze[11][1] = new Array(1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1)
        maze[12][0] = new Array(0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0)
        maze[12][1] = new Array(1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1)
    
        function testNext(nxt) {
            //if ((board.rows[start.rows].cells[start.cols].style.backgroundColor == "rgb(250, 221, 193)") && (nxt.style.backgroundColor == 'rgb(250, 221, 193)')) {
            console.log(board.rows[start.rows].cells[start.cols].style.backgroundImage);
            if ((board.rows[start.rows].cells[start.cols].style.backgroundImage != "") && (nxt.style.backgroundImage != "")) {
                message.innerText = "I see you changed your mind."
                //board.rows[start.rows].cells[start.cols].style.backgroundColor = ""
                board.rows[start.rows].cells[start.cols].style.backgroundImage = ""
                return false
            }
            return true
        }
    
        function moveIt() {
            if (!progress) return
            switch (event.keyCode) {
                case 37: // left
                    if (maze[start.rows][1][start.cols - 1] == 0) {
                        if (testNext(board.rows[start.rows].cells[start.cols - 1])){
                            message.innerText = "Going west..."
                        }
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "0px 30px"                        
                        start.cols--
                        //document.all.board.rows[start.rows].cells[start.cols].style.backgroundColor = "rgb(250, 221, 193)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "0px 30px"
                    } else{
                        message.innerText = "Ouch... you can't go west."
                    }
                    break;
                case 38: // up
                    if (maze[start.rows][0][start.cols] == 0) {
                        if (testNext(board.rows[start.rows - 1].cells[start.cols])){
                            message.innerText = "Going north..."
                        }
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "0px 0px"                        
                        start.rows--
                        //document.all.board.rows[start.rows].cells[start.cols].style.backgroundColor = "rgb(250, 221, 193)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "0px 0px"
                    } else{
                        message.innerText = "Ouch... you can't go north."
                    }
                    break;
                case 39: // right
                    if (maze[start.rows][1][start.cols] == 0) {
                        if (testNext(board.rows[start.rows].cells[start.cols + 1])){
                            message.innerText = "Going east..."
                        }
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "30px 0px"                        
                        start.cols++
                        //document.all.board.rows[start.rows].cells[start.cols].style.backgroundColor = "rgb(250, 221, 193)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "30px 0px"
                    }else{
                        message.innerText = "Ouch... you can't go east."
                    }
                    break;
                case 40: //down
                    if (maze[start.rows + 1] == null) {
                        return
                    }
                    if (maze[start.rows + 1][0][start.cols] == 0) {
                        if (testNext(board.rows[start.rows + 1].cells[start.cols])){
                            message.innerText = "Going south..."
                        }
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "30px 30px"                        
                        start.rows++
                        //document.all.board.rows[start.rows].cells[start.cols].style.backgroundColor = "rgb(250, 221, 193)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundImage = "url(./paw.png)"
                        document.all.board.rows[start.rows].cells[start.cols].style.backgroundPosition = "30px 30px"
                    } else{
                        message.innerText = "Ouch... you can't go south."
                    }
                    break;
            }
    
            if (document.all.board.rows[start.rows].cells[start.cols].classList.contains("end")) {
                message.innerText = "You Win!"
                progress = false
            }
        }
    </SCRIPT>
    <div id="game-frame">
        <P ALIGN=center id="help">请使用键盘上的→←↑↓键进行游戏</P>
        <TABLE ID="board" ALIGN=CENTER CELLSPACING=0 CELLPADDING=0>
            <SCRIPT LANGUAGE="JavaScript">
                for (var row = 0; row < maze.length; row++) {
                    document.write("<TR>")
                    for (var col = 0; col < maze[row][0].length; col++) {
                        document.write("<TD STYLE='")
                        for (var cell = 0; cell < 2; cell++) {
                            if (maze[row][cell][col] == 1){
                                document.write(sides[cell] + ": 2px black solid;")
                            }
                        }
                        if ((0 == col) && (0 != row)){
                            document.write("border-left: 2px black solid;")
                        }
                        if (row == maze.length - 1){
                            document.write("border-bottom: 2px black solid;")
                        }
                        if ((0 == row) && (0 == col)){
                            document.write(" ' class=start></TD>")
                        }else{
                            if ((row == maze.length - 1) && (col == maze[row][0].length - 1)){
                                document.write("' class=end></TD>")
                            }else{
                                document.write("'> </TD>")
                            }
                        }
                    }
                    document.write("</TR>")
                }

                var start = new Object
                start.rows = 0
                start.cols = 0
                progress = true
                document.onkeydown = moveIt;
            </SCRIPT>
        </TABLE>
        <P ID="message"> </P>
    </div>
</body>
</html>
