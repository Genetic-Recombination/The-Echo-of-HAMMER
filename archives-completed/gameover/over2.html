<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./over.css">
    <link href="../favicon.ico" type="image/x-icon" rel="icon">
    <title>结局二</title>
    <script src="smoke.js"></script>
    <style>
        #over-pic-frame {
            position: relative;
            height: 179px;
            width: 720px;
            background: url(./over-2.png) no-repeat;
            border-radius: 7px;
            box-shadow: 0px 1px 1px rgb(255 255 255 /50%),inset 0px 0px 4px 1px rgb(0 0 0 /80%);
        }

        #smoke, #flame {
            position: absolute;
        }

        #smoke {
            top: 0px;
            left: 0px;
        }

        #flame {
            top: 0px;
            left: 0px;
        }
    </style>
    <script>
        window.onload = function(){
            //smoke
            var smokeCanvas = document.getElementById('smoke')
            var smokeCtx = smokeCanvas.getContext('2d')

            var party = smokemachine(smokeCtx, [18, 16, 54])
            party.start() // start animating
            party.setPreDrawCallback(function(dt){
                var t = Math.floor(Math.random() * 300);
                party.addSmoke(250, 135, .9, t);
            })

            //flame
            var flameCanvas = document.getElementById('flame')
            var flameCtx = flameCanvas.getContext('2d')

            const PI = Math.PI;
            const round = Math.round;
            const random = Math.random;
            let frame = 0;
            function particle() {
                this.speed = {
                    x: -1 + random() * 2,
                    y: -3 + random() * 3
                }
                //flame Pos
                this.location = {
                    x: 250,
                    y: 135
                }
                this.radius = .5 + random();
                this.death = 10 + random() * 20;
                this.life = this.death;
                let cv = round(random() * 255);
                this.rgb = `${round(random() * 80) + 175}, ${round(random() * 130)}, ${round(random() * 30)}`;
                //this.rgb = `${cv}, ${cv}, ${cv}`;
            }

            const particles = [];
            const PARTICLE_COUNT = 150;

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                particles.push(new particle());
            }

            function updateParticles(){
                flameCtx.clearRect(0, 0, flameCanvas.width, flameCanvas.height);
                flameCtx.globalCompositeOperation = 'lighter';
                particles.forEach((p, i) => {
                    const gradient = flameCtx.createRadialGradient(
                        p.location.x, p.location.y, 0, p.location.x, p.location.y, p.radius
                    );
                    //p.opacity = random() * (p.death / p.life);
                    p.opacity = p.death / p.life;

                    gradient.addColorStop(0, `rgba(${p.rgb},${p.opacity})`);
                    gradient.addColorStop(.5, `rgba(${p.rgb},${p.opacity})`);
                    gradient.addColorStop(1, `rgba(${p.rgb},0)`);
                    flameCtx.fillStyle = gradient;
                    flameCtx.beginPath();
                    flameCtx.arc(p.location.x, p.location.y, p.radius, 0, PI * 2);
                    flameCtx.fill();

                    p.location.x += p.speed.x;
                    p.location.y += p.speed.y;
                    p.death--;
                    p.radius += 0.6 ;
                    if (p.radius <= 0 || p.opacity <= 0) {
                        particles[i] = new particle();
                    }
                })
            }

            function render() {
                frame ++;
                if(frame % 4 == 0){
                    updateParticles();
                }
                requestAnimationFrame(render)
            }
            render()
        };
    </script>
</head>

<body>

    <div id="top">
        <div id="namekuang">
            <img src="./gamename.png" height="125" />
        </div>
    </div>
    <div id="mid">
        <div id="over-pic-frame">
            <canvas id="smoke" width="600" height="150"></canvas>
            <canvas id="flame" width="600" height="150"></canvas>
        </div>
        <div id="midTxt">
            <h1>结局二&nbsp;&nbsp;&nbsp;杀戮</h1>
            <p class="suojin">你引燃房子杀死了哈里森夫妇，因触犯机器人法律，你最终也难逃一死。</p>
            <p class="suojin">
                警方在房子地下室中发现了几个月前在事故中失踪的布兰德夫妇尸体，认定该起事故是由其女克莱尔.布兰德出于报复而引起。由于当事人的死亡，克莱尔的绑架控诉因缺乏证据无果而终，自身也被宣判死刑。不久后，哈里森集团在混乱中瓦解，机密智慧科技大量外泄，机器人与人类的争端逐步失控……
            </p>
        </div>
    </div>
    <div id="bottom">
        <div id="buttonkuang">
            <button type="button" onclick="window.location.href='../game.html'">重新开始</button>
        </div>
    </div>
</body>

</html>